{"id":37657,"name":"Get Weather Data and Send Email Formula","userId":57378,"accountId":45175,"createdDate":"2020-07-13T20:28:50Z","steps":[{"id":356280,"onSuccess":["SGHeaders"],"onFailure":[],"name":"buildBody","type":"script","properties":{"body":"done({\"personalizations\": [{\"to\": [{\"email\": \"gonzalrm@gmail.com\"}]}],\"from\": {\"email\": \"robpitajobs@gmail.com\"},\"subject\": \"Incorporating SendGrid with Cloud Elements is Fun\",\"content\": [{\"type\": \"text/plain\", \"value\": `Well hello there! Thanks for requesting the last two weeks mean temperature from Rob's Cloud Elements WeatherData Formula Integration.  The average temperature on Divide Peak, WY over the last two weeks was ${steps.formatData}.`}]})"}},{"id":356242,"onSuccess":["getWeatherData"],"onFailure":[],"name":"buildHeader","type":"script","properties":{"body":"done({token: \"NcDCvHIqICuqoZaOPwJxprSWHcdAYWHQ\"})"}},{"id":356278,"onSuccess":["buildBody"],"onFailure":[],"name":"formatData","type":"script","properties":{"body":"const getMeanTemperature = (response) => {\n  let sum = 0;\n  response.forEach(e => \n    sum += e.value\n  )\n  // console.log((sum / response.length + 1).toFixed(2))\n  return (sum / response.length + 1).toFixed(1);\n}\n\n// done(console.log(steps.getWeatherData.response.body.results))\ndone(getMeanTemperature(steps.getWeatherData.response.body.results))"}},{"id":356241,"onSuccess":["formatData"],"onFailure":[],"name":"getWeatherData","type":"httpRequest","properties":{"method":"GET","retryAttempts":"5","url":"https://www.ncdc.noaa.gov/cdo-web/api/v2/data?datasetid=GHCND&datatypeid=TAVG&stationid=GHCND:USS0005G04S&startdate=2020-06-25&enddate=2020-07-09&units=standard","headers":"${steps.buildHeader}"}},{"id":356279,"onSuccess":[],"onFailure":[],"name":"sendEmail","type":"request","properties":{"api":"/messages","retryAttempts":"3","method":"POST","headers":"${steps.SGHeaders}","body":"${steps.buildBody}"}},{"id":356858,"onSuccess":[],"onFailure":[],"name":"sendGridEmail","type":"httpRequest","properties":{"method":"POST","url":"https://api.sendgrid.com/v3/mail/send","headers":"${steps.SGHeaders}","body":"${steps.buildBody}"}},{"id":356282,"onSuccess":[],"onFailure":[],"name":"sendMailJetEmail","type":"request","properties":{"api":"/messages","method":"POST","body":"${steps.buildBody}","headers":"${steps.SGHeaders}"}},{"id":356281,"onSuccess":["sendGridEmail"],"onFailure":[],"name":"SGHeaders","type":"script","properties":{"body":"done({\"Content-Type\": \"application/json\", \"Authorization\": \"Bearer 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\"\n})\n\n"}}],"triggers":[{"id":33576,"onSuccess":["buildHeader"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":72637,"key":"email","name":"email","type":"elementInstance","description":"email element","required":false}]}