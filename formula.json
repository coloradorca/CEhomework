{"id":37709,"name":"Integrate with SG Element","userId":57378,"accountId":45175,"createdDate":"2020-07-14T21:48:13Z","steps":[{"id":356925,"onSuccess":["sendGrid"],"onFailure":[],"name":"buildEmailBody","type":"script","properties":{"body":"done({\n  \"from\": \"robpitajobs@gmail.com\",\n  \"message\": `Well hello there! Thanks for requesting the last two weeks mean temperature from Rob's Cloud Elements WeatherData Formula Integration.  The average temperature on Divide Peak, WY over the last two weeks was ${steps.formatData}.`,\n  \"subject\": \"Your two week mean temperature from Cloud Elements Platform\",\n  \"to\": \"gonzalrm@gmail.com\",\n});"}},{"id":356926,"onSuccess":["getWeatherData"],"onFailure":[],"name":"buildHeader","type":"script","properties":{"body":"done({token: \"NcDCvHIqICuqoZaOPwJxprSWHcdAYWHQ\"})"}},{"id":356927,"onSuccess":["buildEmailBody"],"onFailure":[],"name":"formatData","type":"script","properties":{"body":"const getMeanTemperature = (response) => {\n  let sum = 0;\n  response.forEach(e => \n    sum += e.value\n  )\n  return (sum / response.length + 1).toFixed(1);\n}\n\ndone(getMeanTemperature(steps.getWeatherData.response.body.results))"}},{"id":356928,"onSuccess":["formatData"],"onFailure":[],"name":"getWeatherData","type":"httpRequest","properties":{"retryAttempts":"5","url":"https://www.ncdc.noaa.gov/cdo-web/api/v2/data?datasetid=GHCND&datatypeid=TAVG&stationid=GHCND:USS0005G04S&startdate=2020-06-25&enddate=2020-07-09&units=standard","headers":"${steps.buildHeader}","method":"GET"}},{"id":356934,"onSuccess":[],"onFailure":[],"name":"sendGrid","type":"elementRequest","properties":{"elementInstanceId":"${config.email}","api":"/messages","body":"${steps.buildEmailBody}","method":"POST"}}],"triggers":[{"id":33621,"onSuccess":["buildHeader"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"engine":"v3","active":true,"debugLoggingEnabled":false,"singleThreaded":false,"configuration":[{"id":72740,"key":"email","name":"email","type":"elementInstance","description":"email element","required":true}]}